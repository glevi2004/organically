[debug] [2025-12-03T02:29:16.385Z] ----------------------------------------------------------------------
[debug] [2025-12-03T02:29:16.387Z] Command:       /opt/homebrew/Cellar/node/23.11.0/bin/node /opt/homebrew/bin/firebase deploy --only firestore:rules
[debug] [2025-12-03T02:29:16.387Z] CLI Version:   14.12.0
[debug] [2025-12-03T02:29:16.387Z] Platform:      darwin
[debug] [2025-12-03T02:29:16.387Z] Node Version:  v23.11.0
[debug] [2025-12-03T02:29:16.388Z] Time:          Tue Dec 02 2025 21:29:16 GMT-0500 (Eastern Standard Time)
[debug] [2025-12-03T02:29:16.388Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-03T02:29:16.478Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-03T02:29:16.478Z] > authorizing via signed-in user (leviramosgabriel2021@gmail.com)
[debug] [2025-12-03T02:29:16.478Z] [iam] checking project organically-2f124 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-03T02:29:16.479Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:16.479Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:16.479Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions [none]
[debug] [2025-12-03T02:29:16.479Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions x-goog-quota-user=projects/organically-2f124
[debug] [2025-12-03T02:29:16.479Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-03T02:29:16.732Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions 200
[debug] [2025-12-03T02:29:16.733Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'organically-2f124'...
[info] 
[info] i  deploying firestore 
[info] i  cloud.firestore: checking src/firebase/firestore.rules for compilation errors... 
[debug] [2025-12-03T02:29:16.735Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:16.735Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:16.735Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test [none]
[debug] [2025-12-03T02:29:16.735Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test [omitted]
[debug] [2025-12-03T02:29:17.009Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test 200
[debug] [2025-12-03T02:29:17.009Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test {}
[info] ✔  cloud.firestore: rules file src/firebase/firestore.rules compiled successfully 
[debug] [2025-12-03T02:29:17.011Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.011Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.011Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) [none]
[debug] [2025-12-03T02:29:17.381Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) 200
[debug] [2025-12-03T02:29:17.381Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) {"name":"projects/organically-2f124/databases/(default)","uid":"79219953-cf4e-4f74-aeb4-ee624555d8c6","createTime":"2025-12-01T05:11:17.118971Z","updateTime":"2025-12-01T05:11:17.118971Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-03T01:29:17.392305Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"ILunhdWvoJEDMKeijrD0m5ED"}
[debug] [2025-12-03T02:29:17.383Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.383Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.384Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases pageSize=10&pageToken=
[debug] [2025-12-03T02:29:17.506Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases 200
[debug] [2025-12-03T02:29:17.507Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases {"releases":[{"name":"projects/organically-2f124/releases/cloud.firestore","rulesetName":"projects/organically-2f124/rulesets/483f328a-78ef-49b4-8087-d5e089d2ace1","createTime":"2025-12-01T05:11:21.754877Z","updateTime":"2025-12-03T02:27:50.099156Z"},{"name":"projects/organically-2f124/releases/firebase.storage/organically-2f124.firebasestorage.app","rulesetName":"projects/organically-2f124/rulesets/3c8237c3-e1fe-4fd3-b7a3-95acaabb84b8","createTime":"2025-12-01T11:01:58.085017Z","updateTime":"2025-12-01T11:20:02.911326Z"}]}
[debug] [2025-12-03T02:29:17.522Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.522Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.522Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/483f328a-78ef-49b4-8087-d5e089d2ace1 [none]
[debug] [2025-12-03T02:29:17.699Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/483f328a-78ef-49b4-8087-d5e089d2ace1 200
[debug] [2025-12-03T02:29:17.699Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/483f328a-78ef-49b4-8087-d5e089d2ace1 [omitted]
[info] i  firestore: uploading rules src/firebase/firestore.rules... 
[debug] [2025-12-03T02:29:17.700Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.700Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:17.700Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets [none]
[debug] [2025-12-03T02:29:17.700Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets [omitted]
[debug] [2025-12-03T02:29:18.023Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets 200
[debug] [2025-12-03T02:29:18.024Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets {"name":"projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3","source":{"files":[{"content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // --- Helper Functions ---\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    function isOwner(userId) {\n      return isAuthenticated() && request.auth.uid == userId;\n    }\n\n    // Helper to check if the user is only changing allowed fields\n    function onlyUpdating(allowedFields) {\n      return request.resource.data.diff(resource.data).affectedKeys().hasOnly(allowedFields);\n    }\n\n    // --- USERS COLLECTION ---\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n\n      allow create: if isOwner(userId)\n                    && request.resource.data.email is string\n                    // SECURITY: Prevent extra fields (e.g. isAdmin)\n                    && request.resource.data.keys().hasOnly(['email', 'userId', 'createdAt']);\n\n      allow update: if isOwner(userId)\n                    && request.resource.data.userId == resource.data.userId\n                    // SECURITY: Allow updating email/profile info, but not userId\n                    && onlyUpdating(['email', 'updatedAt']);\n\n      allow delete: if isOwner(userId);\n    }\n\n\n    // --- PROFILES COLLECTION ---\n    match /profiles/{profileId} {\n      // Allow listing/querying profiles for authenticated users\n      allow list: if isAuthenticated();\n      \n      // When reading a specific profile, verify ownership\n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid\n                    && request.resource.data.name is string;\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    && request.resource.data.userId == resource.data.userId;\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n\n    // --- POSTS COLLECTION ---\n    match /posts/{postId} {\n      // Allow listing/querying - client code filters by profileId\n      allow list: if isAuthenticated();\n      \n      // When reading a specific document, verify ownership\n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid\n                    // 1. Validate Data Types\n                    && request.resource.data.title is string\n                    && request.resource.data.content is string\n                    && request.resource.data.platform is string\n                    && request.resource.data.status is string\n                    && request.resource.data.profileId is string\n                    // 2. Referential Integrity (Must own the profile)\n                    && exists(/databases/$(database)/documents/profiles/$(request.resource.data.profileId))\n                    && get(/databases/$(database)/documents/profiles/$(request.resource.data.profileId)).data.userId == request.auth.uid\n                    // 3. Strict Schema (Prevents injection) - optional fields: scheduledDate, postedDate, hooks, hashtags, notes\n                    && request.resource.data.keys().hasOnly(['userId', 'title', 'content', 'platform', 'status', 'profileId', 'scheduledDate', 'postedDate', 'hooks', 'hashtags', 'notes', 'createdAt', 'updatedAt']);\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    // Ensure the post stays with the original user and profile\n                    && request.resource.data.userId == resource.data.userId\n                    && request.resource.data.profileId == resource.data.profileId\n                    // Allow editing content, but NOT ownership or profile association\n                    && onlyUpdating(['title', 'content', 'platform', 'status', 'scheduledDate', 'notes', 'hooks', 'hashtags', 'updatedAt']);\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n\n    // --- IDEAS COLLECTION ---\n    match /ideas/{ideaId} {\n      // Allow listing/querying - client code filters by profileId\n      allow list: if isAuthenticated();\n      \n      // When reading a specific document, verify ownership\n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid\n                    && request.resource.data.title is string\n                    && request.resource.data.description is string\n                    && request.resource.data.profileId is string\n                    // Referential Integrity\n                    && exists(/databases/$(database)/documents/profiles/$(request.resource.data.profileId))\n                    && get(/databases/$(database)/documents/profiles/$(request.resource.data.profileId)).data.userId == request.auth.uid\n                    // Strict Schema\n                    && request.resource.data.keys().hasOnly(['userId', 'title', 'description', 'profileId', 'createdAt']);\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    && request.resource.data.userId == resource.data.userId\n                    && request.resource.data.profileId == resource.data.profileId\n                    // Only allow updating title and description\n                    && onlyUpdating(['title', 'description', 'updatedAt']);\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n    // Default deny\n    match /{document=**} {\n      allow read, write: if false;\n    }\n  }\n}","name":"src/firebase/firestore.rules"}]},"createTime":"2025-12-03T02:29:18.044575Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-12-03T02:29:18.024Z] [rules] created ruleset projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3
[debug] [2025-12-03T02:29:18.025Z] [rules] releasing cloud.firestore/(default) with ruleset projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3
[debug] [2025-12-03T02:29:18.026Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:18.026Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:29:18.026Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) [none]
[debug] [2025-12-03T02:29:18.026Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) {"release":{"name":"projects/organically-2f124/releases/cloud.firestore/(default)","rulesetName":"projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3"}}
[debug] [2025-12-03T02:29:18.350Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) 200
[debug] [2025-12-03T02:29:18.351Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) {"name":"projects/organically-2f124/releases/cloud.firestore","rulesetName":"projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3","createTime":"2025-12-01T05:11:21.754877Z","updateTime":"2025-12-03T02:29:18.358359Z"}
[debug] [2025-12-03T02:29:18.351Z] [rules] updated release projects/organically-2f124/releases/cloud.firestore
[info] ✔  firestore: released rules src/firebase/firestore.rules to cloud.firestore 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/organically-2f124/overview
[debug] [2025-12-03T02:31:50.983Z] ----------------------------------------------------------------------
[debug] [2025-12-03T02:31:50.984Z] Command:       /opt/homebrew/Cellar/node/23.11.0/bin/node /opt/homebrew/bin/firebase deploy --only firestore:rules
[debug] [2025-12-03T02:31:50.984Z] CLI Version:   14.12.0
[debug] [2025-12-03T02:31:50.984Z] Platform:      darwin
[debug] [2025-12-03T02:31:50.985Z] Node Version:  v23.11.0
[debug] [2025-12-03T02:31:50.985Z] Time:          Tue Dec 02 2025 21:31:50 GMT-0500 (Eastern Standard Time)
[debug] [2025-12-03T02:31:50.985Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-03T02:31:51.075Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-03T02:31:51.075Z] > authorizing via signed-in user (leviramosgabriel2021@gmail.com)
[debug] [2025-12-03T02:31:51.076Z] [iam] checking project organically-2f124 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-03T02:31:51.076Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.076Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.076Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions [none]
[debug] [2025-12-03T02:31:51.076Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions x-goog-quota-user=projects/organically-2f124
[debug] [2025-12-03T02:31:51.077Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-03T02:31:51.338Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions 200
[debug] [2025-12-03T02:31:51.338Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/organically-2f124:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'organically-2f124'...
[info] 
[info] i  deploying firestore 
[info] i  cloud.firestore: checking src/firebase/firestore.rules for compilation errors... 
[debug] [2025-12-03T02:31:51.341Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.341Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.341Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test [none]
[debug] [2025-12-03T02:31:51.341Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test [omitted]
[debug] [2025-12-03T02:31:51.527Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test 200
[debug] [2025-12-03T02:31:51.527Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124:test {}
[info] ✔  cloud.firestore: rules file src/firebase/firestore.rules compiled successfully 
[debug] [2025-12-03T02:31:51.529Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.529Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.529Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) [none]
[debug] [2025-12-03T02:31:51.819Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) 200
[debug] [2025-12-03T02:31:51.819Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/organically-2f124/databases/(default) {"name":"projects/organically-2f124/databases/(default)","uid":"79219953-cf4e-4f74-aeb4-ee624555d8c6","createTime":"2025-12-01T05:11:17.118971Z","updateTime":"2025-12-01T05:11:17.118971Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-03T01:31:51.868167Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"ILbg2Z6woJEDMKeijrD0m5ED"}
[debug] [2025-12-03T02:31:51.820Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.821Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:51.821Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases pageSize=10&pageToken=
[debug] [2025-12-03T02:31:52.021Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases 200
[debug] [2025-12-03T02:31:52.021Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases {"releases":[{"name":"projects/organically-2f124/releases/cloud.firestore","rulesetName":"projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3","createTime":"2025-12-01T05:11:21.754877Z","updateTime":"2025-12-03T02:29:18.358359Z"},{"name":"projects/organically-2f124/releases/firebase.storage/organically-2f124.firebasestorage.app","rulesetName":"projects/organically-2f124/rulesets/3c8237c3-e1fe-4fd3-b7a3-95acaabb84b8","createTime":"2025-12-01T11:01:58.085017Z","updateTime":"2025-12-01T11:20:02.911326Z"}]}
[debug] [2025-12-03T02:31:52.032Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.032Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.032Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3 [none]
[debug] [2025-12-03T02:31:52.133Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3 200
[debug] [2025-12-03T02:31:52.133Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets/22a5dc92-b700-4035-8d1e-687459baece3 [omitted]
[info] i  firestore: uploading rules src/firebase/firestore.rules... 
[debug] [2025-12-03T02:31:52.134Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.134Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.134Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets [none]
[debug] [2025-12-03T02:31:52.134Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets [omitted]
[debug] [2025-12-03T02:31:52.388Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets 200
[debug] [2025-12-03T02:31:52.389Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/organically-2f124/rulesets {"name":"projects/organically-2f124/rulesets/f70f35bb-3189-4191-b47d-cfb6bb03af89","source":{"files":[{"content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // --- Helper Functions ---\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n\n    function isOwner(userId) {\n      return isAuthenticated() && request.auth.uid == userId;\n    }\n\n    function onlyUpdating(allowedFields) {\n      return request.resource.data.diff(resource.data).affectedKeys().hasOnly(allowedFields);\n    }\n\n    // --- USERS COLLECTION ---\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n\n      allow create: if isOwner(userId)\n                    && request.resource.data.email is string\n                    // SECURITY: Prevent extra fields (e.g. isAdmin)\n                    && request.resource.data.keys().hasOnly(['email', 'userId', 'createdAt']);\n\n      allow update: if isOwner(userId)\n                    && request.resource.data.userId == resource.data.userId\n                    // SECURITY: Allow updating email/profile info, but not userId\n                    && onlyUpdating(['email', 'updatedAt']);\n\n      allow delete: if isOwner(userId);\n    }\n\n\n    // --- PROFILES COLLECTION ---\n    match /profiles/{profileId} {\n      // Allow listing/querying profiles for authenticated users\n      allow list: if isAuthenticated();\n      \n      // When reading a specific profile, verify ownership\n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid\n                    && request.resource.data.name is string;\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    && request.resource.data.userId == resource.data.userId;\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n\n    // --- POSTS COLLECTION ---\n    match /posts/{postId} {\n      allow list: if isAuthenticated();\n      \n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid;\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    && request.resource.data.userId == resource.data.userId;\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n\n    // --- IDEAS COLLECTION ---\n    match /ideas/{ideaId} {\n      allow list: if isAuthenticated();\n      \n      allow get: if isAuthenticated() && resource.data.userId == request.auth.uid;\n\n      allow create: if isAuthenticated()\n                    && request.resource.data.userId == request.auth.uid;\n\n      allow update: if isAuthenticated()\n                    && resource.data.userId == request.auth.uid\n                    && request.resource.data.userId == resource.data.userId;\n\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\n    }\n\n    // Default deny\n    match /{document=**} {\n      allow read, write: if false;\n    }\n  }\n}","name":"src/firebase/firestore.rules"}]},"createTime":"2025-12-03T02:31:52.414415Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-12-03T02:31:52.389Z] [rules] created ruleset projects/organically-2f124/rulesets/f70f35bb-3189-4191-b47d-cfb6bb03af89
[debug] [2025-12-03T02:31:52.389Z] [rules] releasing cloud.firestore/(default) with ruleset projects/organically-2f124/rulesets/f70f35bb-3189-4191-b47d-cfb6bb03af89
[debug] [2025-12-03T02:31:52.390Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.390Z] Checked if tokens are valid: true, expires at: 1764732379825
[debug] [2025-12-03T02:31:52.390Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) [none]
[debug] [2025-12-03T02:31:52.390Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) {"release":{"name":"projects/organically-2f124/releases/cloud.firestore/(default)","rulesetName":"projects/organically-2f124/rulesets/f70f35bb-3189-4191-b47d-cfb6bb03af89"}}
[debug] [2025-12-03T02:31:52.822Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) 200
[debug] [2025-12-03T02:31:52.823Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/organically-2f124/releases/cloud.firestore/(default) {"name":"projects/organically-2f124/releases/cloud.firestore","rulesetName":"projects/organically-2f124/rulesets/f70f35bb-3189-4191-b47d-cfb6bb03af89","createTime":"2025-12-01T05:11:21.754877Z","updateTime":"2025-12-03T02:31:52.766065Z"}
[debug] [2025-12-03T02:31:52.823Z] [rules] updated release projects/organically-2f124/releases/cloud.firestore
[info] ✔  firestore: released rules src/firebase/firestore.rules to cloud.firestore 
[info] 
[info] ✔  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/organically-2f124/overview
